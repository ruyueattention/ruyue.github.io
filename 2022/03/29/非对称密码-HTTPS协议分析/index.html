<!-- build time:Mon Feb 20 2023 15:24:48 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="//fastly.jsdelivr.net/gh/ruyueattention/ruyueattention.github.io/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="//fastly.jsdelivr.net/gh/ruyueattention/ruyueattention.github.io/images/favicon.ico"><link rel="mask-icon" href="//fastly.jsdelivr.net/gh/ruyueattention/ruyueattention.github.io/images/logo.svg" color=""><link rel="manifest" href="//fastly.jsdelivr.net/gh/ruyueattention/ruyueattention.github.io/images/manifest.json"><meta name="msapplication-config" content="//fastly.jsdelivr.net/gh/ruyueattention/ruyueattention.github.io/images/browserconfig.xml"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="如月专注" href="http://example.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="如月专注" href="http://example.com/atom.xml"><link rel="alternate" type="application/json" title="如月专注" href="http://example.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="//fastly.jsdelivr.net/gh/ruyueattention/ruyueattention.github.io/css/app.css?v=0.2.5"><link rel="canonical" href="http://example.com/2022/03/29/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%AF%86%E7%A0%81-HTTPS%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90/"><title>HTTPS协议分析 - 密码学 | 如月专注</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">HTTPS协议分析</h1><div class="meta"><span class="item" title="创建时间：2022-03-29 14:17:21"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-03-29T14:17:21+08:00">2022-03-29</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>4.4k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>4 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">如月专注</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://ruyue-1258558004.cos.ap-guangzhou.myqcloud.com/note/tr.jpg"></li><li class="item" data-background-image="https://ruyue-1258558004.cos.ap-guangzhou.myqcloud.com/note/1.png"></li><li class="item" data-background-image="https://ruyue-1258558004.cos.ap-guangzhou.myqcloud.com/note/小夫5.png"></li><li class="item" data-background-image="https://ruyue-1258558004.cos.ap-guangzhou.myqcloud.com/note/3.jpg"></li><li class="item" data-background-image="https://ruyue-1258558004.cos.ap-guangzhou.myqcloud.com/note/wet.jpg"></li><li class="item" data-background-image="https://ruyue-1258558004.cos.ap-guangzhou.myqcloud.com/note/小夫3.png"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E5%AF%86%E7%A0%81%E5%AD%A6/" itemprop="item" rel="index" title="分类于 密码学"><span itemprop="name">密码学</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://example.com/2022/03/29/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%AF%86%E7%A0%81-HTTPS%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="//fastly.jsdelivr.net/gh/ruyueattention/ruyueattention.github.io/images/avatar.jpg"><meta itemprop="name" content="ruyue"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="如月专注"></span><div class="body md" itemprop="articleBody"><h1 id="https介绍"><a class="anchor" href="#https介绍">#</a> HTTPS 介绍</h1><p>HTTPS 并不是一个新协议，而是 HTTP+SSL（TLS）。原本 HTTP 先和 TCP（假定传输层是 TCP 协议）直接通信，而加了 SSL 后，就变成 HTTP 先和 SSL 通信，再由 SSL 和 TCP 通信，相当于 SSL 被嵌在了 HTTP 和 TCP 之间。</p><p>而在整个 HTTPS 流程中，用到了两种加密方式：对称加密和非对称加密。</p><p>这是因为非对称加密的效率远不如对称加密，因此通常是用非对称加密来加密对称加密的密钥。</p><p>使用对称加密来加密真正的 http 数据。</p><p><img data-src="https://ruyue-1258558004.cos.ap-guangzhou.myqcloud.com/note/image-20220401135729951.png" alt="image-20220401135729951"></p><h1 id="抓包分析单向认证"><a class="anchor" href="#抓包分析单向认证">#</a> 抓包分析（单向认证）</h1><p>SSL 主要的作用就是用来协商通信双方的安全参数，然后基于协商的安全参数进行安全通信。所以首当其冲地，第一个要解决的问题就是如何进行密钥交换。考虑到对称密码和非对称密码的性能差异显著，在实际使用中往往使用对称密码对数据进行加密，而使用非对称密码来完成重要的密钥交换和身份认证。</p><p>SSL 协议分为两个阶段：握手阶段和应用阶段。握手阶段主要负责协商安全参数，应用阶段则基于前面协商的安全参数进行数据通信。</p><h2 id="整体报文"><a class="anchor" href="#整体报文">#</a> 整体报文</h2><p>可以看到，一个整体的报文流程如下，从 588-598 是一个较完整的过程。</p><p>但我们先从 560-572 分析，可以看到，560-562 这三个包，很明显是一个简单的 tcp 三次握手判断存活，然后才开始密钥交换，但明显在这个会话中，握手是没成功的（服务端证书未通过浏览器校验）</p><p>接着我在浏览器端选择信任证书后，就开始了第二次 TLS 握手，即 588-598 这段，从中我们大致可以看到，如下几个部分：</p><p>​	①TCP 三次握手（判断存活，部署于 TLS 握手协议的内容）</p><p>​	②Client Hellow</p><p>​	③ <strong>Server Hellow，Certificate ，Server Key Exchange</strong>、Server Hello Done</p><p>​	④Client Key Exchange、Change Cipher Spec、Encrypted Handshake Message</p><p>​	⑤New Session Ticket、、Change Cipher Spec、Encrypted Handshake Message</p><p>​	⑥Application Data</p><p>下面我们就详细介绍这几个部分的消息是干嘛的</p><p><img data-src="https://ruyue-1258558004.cos.ap-guangzhou.myqcloud.com/note/image-20220401135951885.png" alt="image-20220401135951885"></p><p>注：上面的流程是单向认证（服务端没有验证客户端的身份），如果服务端也需要验客户端的身份，会在第一次交互中发送 <code>Certificate Request</code> 消息，客户端相应的在第二次交互中发送自己的 <code>Certificate</code> 以及 <code>CertificateVerify</code> 消息给服务端。</p><p><strong>PS：这里简单的提一下浏览器是如何验证证书的合法性</strong></p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3F1ZXN0aW9uLzM3MzcwMjE2">https://www.zhihu.com/question/37370216</span></p><p>从上面的 Certificate 包中，浏览器就得到了证书的一些信息，然后会按照如下流程来对证书进行校验，若合法则开始密钥协商交换。否则中断当前的会话。</p><p><img data-src="https://ruyue-1258558004.cos.ap-guangzhou.myqcloud.com/note/v2-710d8b9f3527db981587af396011d9cd_720w.webp" alt="img"></p><p>CA 签发证书的过程，如上图左边部分：</p><ul><li>首先 CA 会把持有者的公钥、用途、颁发者、有效时间等信息打成一个包，然后对这些信息进行 Hash 计算，得到一个 Hash 值；</li><li>然后 CA 会使用自己的私钥将该 Hash 值加密，生成 Certificate Signature，也就是 CA 对证书做了签名；</li><li>最后将 Certificate Signature 添加在文件证书上，形成数字证书；</li></ul><p>客户端校验服务端的数字证书的过程，如上图右边部分：</p><ul><li>首先客户端会使用同样的 Hash 算法获取该证书的 Hash 值 H1；</li><li>通常浏览器和操作系统中集成了 CA 的<span class="exturl" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3NlYXJjaD9xPSVFNSU4NSVBQyVFOSU5MiVBNSVFNCVCRiVBMSVFNiU4MSVBRiZhbXA7c2VhcmNoX3NvdXJjZT1FbnRpdHkmYW1wO2h5YnJpZF9zZWFyY2hfc291cmNlPUVudGl0eSZhbXA7aHlicmlkX3NlYXJjaF9leHRyYT0lN0IlMjJzb3VyY2VUeXBlJTIyJTNBJTIyYW5zd2VyJTIyJTJDJTIyc291cmNlSWQlMjIlM0ExOTE0MDc1OTM1JTdE">公钥信息</span>（浏览器预存的一些 CA 的公钥）</li></ul><h2 id="client-hellow-客户端发送"><a class="anchor" href="#client-hellow-客户端发送">#</a> Client Hellow （客户端发送）</h2><p>Client 和 Server 建立连接的时候，Client 首先会先发送<span class="exturl" data-url="aHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzUyNDYjc2VjdGlvbi03LjQuMS4y"> Client Hello</span> 问候消息，主要是发送客户端所支持的 SSL/TLS 最高协议版本号和所支持的加密算法集合及压缩方法集合等信息给服务器端。</p><p>如下图：</p><p><img data-src="https://ruyue-1258558004.cos.ap-guangzhou.myqcloud.com/note/image-20220401141845311.png" alt="image-20220401141845311"></p><p>其中加密套件较为重要：这里简单介绍，比如 TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256，密钥协商算法是 ECDHE（短暂椭圆曲线），身份认证算法是 RSA，对称加密算法是 AES_128_GCM，消息摘要算法是 SHA256。</p><h2 id="server-hellow-服务端返回"><a class="anchor" href="#server-hellow-服务端返回">#</a> Server Hellow （服务端返回）</h2><p>服务端收到了客户端的 Hello，通过客户端的配置信息，结合服务端的自身情况，给出了最终的配置信息。</p><p>以客户端支持的优秀，但是在 web 服务器中可以设置以服务端优先（避免 TLS 降级攻击）。</p><p><img data-src="https://ruyue-1258558004.cos.ap-guangzhou.myqcloud.com/note/image-20220401150027032.png" alt="image-20220401150027032"></p><p>PS: 这里服务器选择的密码套件很关键，这关系着我们能否解密流量。</p><h2 id="server-certificate服务端返回"><a class="anchor" href="#server-certificate服务端返回">#</a> Server Certificate（服务端返回）</h2><p>服务端下发证书，让客户端验证服务端的身份，包含后面用于加密预主密钥的的公钥（由前面 ServerHellow 选择的加密套件决定，临时的密钥交换协议则不用这个公钥去加密预主密钥）。</p><p><img data-src="https://ruyue-1258558004.cos.ap-guangzhou.myqcloud.com/note/image-20220401142857254.png" alt="image-20220401142857254"></p><h2 id="server-key-exchange服务端返回"><a class="anchor" href="#server-key-exchange服务端返回">#</a> Server Key Exchange（服务端返回）</h2><p>根据 Server Hellow 选择的算法，如果选择的是临时的密钥交换协议，那么就会发送该消息，以便双方协商参数，生成预主密钥。</p><p>这里服务器会生成一对临时的公私钥 。需要注意的是 DHE_DSS、DHE_RSA、DH_anon 算法会发送此消息。TLS_RSA、DH_DSS、DH_RSA 算法不会发送此消息。</p><p><img data-src="https://ruyue-1258558004.cos.ap-guangzhou.myqcloud.com/note/image-20220401143537716.png" alt="image-20220401143537716"></p><h2 id="server-hello-done服务端返回"><a class="anchor" href="#server-hello-done服务端返回">#</a> Server Hello Done（服务端返回）</h2><p>当 Server 发送完问候和相关消息，而且这些消息足够支持密钥交换，紧接着 Server 会发送一条 Server Hello Done 消息。<br>发送完成后，Server 会等待 Client 响应，Client 收到消息后，先验证 Server Certificate 证书链，再继续进行 Client 的密钥交换。</p><p><img data-src="https://ruyue-1258558004.cos.ap-guangzhou.myqcloud.com/note/image-20220401143806891.png" alt="image-20220401143806891"></p><h2 id="client-key-exchange客户端发送"><a class="anchor" href="#client-key-exchange客户端发送">#</a> Client Key Exchange（客户端发送）</h2><p>Client Key Exchange 将作为 Server Hello Done 之后的第一条消息（单向认证的情况下）。<br>通过此消息，可以直接交换 premaster secret，或者交换 DH 的协商参数。</p><p>客户端随机生成 46 位的随机数 + 2 位的 client_version, 加密后发送给服务端。服务端接收到后能通过私钥进行解密得预主密钥。</p><p><img data-src="https://ruyue-1258558004.cos.ap-guangzhou.myqcloud.com/note/image-20220401150224122.png" alt="image-20220401150224122"></p><h2 id="change-cipher-spec客户端发送"><a class="anchor" href="#change-cipher-spec客户端发送">#</a> Change Cipher Spec（客户端发送）</h2><p>告诉服务器我这边已经完成了密钥交换了，接下来该进入密钥检查环节了。</p><p><img data-src="https://ruyue-1258558004.cos.ap-guangzhou.myqcloud.com/note/image-20220401145550578.png" alt="image-20220401145550578"></p><h2 id="encrypted-handshake-message客户端发送"><a class="anchor" href="#encrypted-handshake-message客户端发送">#</a> Encrypted Handshake Message（客户端发送）</h2><p>这里就是客户端的 Client Finished 消息。也是整个 SSL 过程中，发送给服务端的第一个加密消息。待后面服务端接收后，服务端用同样的方式计算出已交互的握手消息的摘要，与用主密钥解密后的消息进行对比，一致的话，说明两端生成的主密钥一致，完成了密钥交换。</p><p>PS：这个 Encrypted handshake message 就是把当前（准备发送 Encrypted handshake message）前，自己收到的数据和发送的数据进行一次简单运算（hash + 对称加密），一方面能够防止数据被篡改，一方面用来确认密钥的准确性。</p><p><img data-src="https://ruyue-1258558004.cos.ap-guangzhou.myqcloud.com/note/image-20220401150629000.png" alt="image-20220401150629000"></p><h2 id="new-session-ticket-change-cipher-spec-encrypted-handshake-message-服务端发送"><a class="anchor" href="#new-session-ticket-change-cipher-spec-encrypted-handshake-message-服务端发送">#</a> New Session Ticket、Change Cipher Spec、Encrypted Handshake Message （服务端发送）</h2><p>①服务器告诉客户端一个会话时间，用处就是在一段时间之内（超时时间到来之前），双方都以刚刚交换的密钥进行通信，超过不通信就握手失败。</p><p>②服务端通知服务端，后续的报文将会被加密。</p><p>③和上面的客户端的 Encrypted Handshake Message 一样，是服务端发出的第一条加密信息。客户端按照协商好的主密钥解密并验证正确后，SSL 握手阶段完成。</p><p><img data-src="https://ruyue-1258558004.cos.ap-guangzhou.myqcloud.com/note/image-20220401150818545.png" alt="image-20220401150818545"></p><h2 id="application-data"><a class="anchor" href="#application-data">#</a> Application Data</h2><p>应用数据传输消息。因为这里是 HTTPS，所以可以对 HTTP 应用协议数据加密然后传输了。并且从这里，无法知道密钥是什么，也无法知道这里传输的是什么数据。</p><p><img data-src="https://ruyue-1258558004.cos.ap-guangzhou.myqcloud.com/note/image-20220401151058222.png" alt="image-20220401151058222"></p><h2 id="小结"><a class="anchor" href="#小结">#</a> 小结</h2><p>①对称加密的密钥是由客户端生成的<br>②这个密钥经过了服务端提供的公钥进行加密，也就是说只有服务端的私钥能够解密获取正确的密钥。（客户端缓存中也有）<br>③SSL 证书在这个过程中起了两个作用：身份验证与数据加密（在实际的过程中，通常证书私钥的功能被削弱到只用来做身份认证）。浏览器通过预存 CA 公钥判断证书合法性，而数据加密则是要看具体情况了。单纯使用 RSA 算法时，RSA 算法既用来验证服务器的身份，也用来加密预主密钥。单纯采用 DH 算法时，DH 算法只用来加密预主密钥，没办法验证服务器身份，称为 anonymous DH。DH 算法还可以跟 RSA 算法一起使用，RSA 验证服务器身份，DH 算法加密预主密钥。而上面的抓包中，证书的公钥就没被用来加密预主密钥。</p><h1 id="思考我们什么情况下能用私钥去破解tls加密的数据"><a class="anchor" href="#思考我们什么情况下能用私钥去破解tls加密的数据">#</a> 思考：我们什么情况下能用私钥去破解 TLS 加密的数据</h1><p><strong>这里先给结论：有 Server Key Exchange 个包就做不到证书私钥破解数据</strong></p><p>在上面过程中决定着我们能否解包一个关键地方在于服务端选择的加密套件是什么？如果使用临时的密钥交换协议，那么使用的并不是证书的公私钥，也自然没办法破解数据。</p><p>而 Server Key Exchange 这个包就是服务器发给客户端的临时公钥，因此判断是否存在 Server Key Exchange 这个包就能知道这个包的数据能否使用证书的私钥去破解。</p><p>因此我们比较关注以下问题：</p><pre><code>
Q：什么时候才使用证书的公钥去加密对称加密密钥？或者说什么时候才不发送Server Key Exchange这个值？

A：对于使用非DHE/ECDHE非对称密钥协商算法的SSL握手将不会发送Server Key Exchange。也就是说DHE/ECDHE使用的是临时密钥，证书公私钥不起数据加密作用。
</code></pre><pre><code>Q:什么是DH和ECDH，加个E又是什么情况？

A: DH即Diffie Hellman密钥协商算法，而ECDH则是椭圆曲线密钥协商算法，是ECC（椭圆曲线）和DH算法的结合。
DHE和ECDHE多了个E即Elliptic Curve Diffie-Hellman Exchange Ephemeral，短暂的（椭圆曲线）密钥协商算法。多了一个Ephemeral（短暂的），即密钥是短暂的，每次握手都会协商出一个预主密钥，和RSA、DH、ECDH不同：

 • RSA，证书公钥、私钥直接参与密钥交换，私钥泄漏，存在向前攻击问题。

 • DH、ECDH，证书公钥、私钥参与协商，对于Client，证书公钥作为随机数X1。对于Server，证书私钥作为随机数X2。

 • DHE、ECDHE，证书公钥、私钥不参与协商，每次握手都会计算随机数X。

很显然，这几种协商算法中，ECDHE是最安全的，即便当前会话的密钥泄漏了，也不影响之前的会话，是前向安全的。所以现在基本都是使用ECDHE算法。
</code></pre><pre><code>Q：什么样的证书才会使用自己的私钥，而不是临时私钥？

A：根据RFC标准中的描述， 如果服务器证书包含Diffie Hellman公钥，则使用证书的私钥。但是事实上，服务器对于加密套件有着自己的权重算法，除非是没得选的情况下，不然不会轻易使用RSA和ECDH算法。
</code></pre><p><img data-src="https://ruyue-1258558004.cos.ap-guangzhou.myqcloud.com/note/image-20220401152026153.png" alt="image-20220401152026153"></p></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2023-02-13 16:04:37" itemprop="dateModified" datetime="2023-02-13T16:04:37+08:00">2023-02-13</time> </span><span id="2022/03/29/非对称密码-HTTPS协议分析/" class="item leancloud_visitors" data-flag-title="HTTPS协议分析" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>ruyue <i class="ic i-at"><em>@</em></i>如月专注</li><li class="link"><strong>本文链接：</strong> <a href="http://example.com/2022/03/29/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%AF%86%E7%A0%81-HTTPS%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90/" title="HTTPS协议分析">http://example.com/2022/03/29/非对称密码-HTTPS协议分析/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2022/03/28/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%AF%86%E7%A0%81-SSL%E8%AF%81%E4%B9%A6/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;ruyue-1258558004.cos.ap-guangzhou.myqcloud.com&#x2F;note&#x2F;36.png" title="非对称密码-SSL证书"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 密码学</span><h3>非对称密码-SSL证书</h3></a></div><div class="item right"><a href="/2022/04/01/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%AF%86%E7%A0%81-%E4%BD%BF%E7%94%A8%E7%A7%81%E9%92%A5%E7%A0%B4%E8%A7%A3https%E6%B5%81%E9%87%8F/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;ruyue-1258558004.cos.ap-guangzhou.myqcloud.com&#x2F;note&#x2F;6.jpg" title="非对称密码-使用私钥破解https流量"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 密码学</span><h3>非对称密码-使用私钥破解https流量</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#https%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">HTTPS 介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8A%93%E5%8C%85%E5%88%86%E6%9E%90%E5%8D%95%E5%90%91%E8%AE%A4%E8%AF%81"><span class="toc-number">2.</span> <span class="toc-text">抓包分析（单向认证）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B4%E4%BD%93%E6%8A%A5%E6%96%87"><span class="toc-number">2.1.</span> <span class="toc-text">整体报文</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#client-hellow-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%8F%91%E9%80%81"><span class="toc-number">2.2.</span> <span class="toc-text">Client Hellow （客户端发送）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#server-hellow-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%BF%94%E5%9B%9E"><span class="toc-number">2.3.</span> <span class="toc-text">Server Hellow （服务端返回）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#server-certificate%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%BF%94%E5%9B%9E"><span class="toc-number">2.4.</span> <span class="toc-text">Server Certificate（服务端返回）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#server-key-exchange%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%BF%94%E5%9B%9E"><span class="toc-number">2.5.</span> <span class="toc-text">Server Key Exchange（服务端返回）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#server-hello-done%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%BF%94%E5%9B%9E"><span class="toc-number">2.6.</span> <span class="toc-text">Server Hello Done（服务端返回）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#client-key-exchange%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%8F%91%E9%80%81"><span class="toc-number">2.7.</span> <span class="toc-text">Client Key Exchange（客户端发送）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#change-cipher-spec%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%8F%91%E9%80%81"><span class="toc-number">2.8.</span> <span class="toc-text">Change Cipher Spec（客户端发送）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#encrypted-handshake-message%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%8F%91%E9%80%81"><span class="toc-number">2.9.</span> <span class="toc-text">Encrypted Handshake Message（客户端发送）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#new-session-ticket-change-cipher-spec-encrypted-handshake-message-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%91%E9%80%81"><span class="toc-number">2.10.</span> <span class="toc-text">New Session Ticket、Change Cipher Spec、Encrypted Handshake Message （服务端发送）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#application-data"><span class="toc-number">2.11.</span> <span class="toc-text">Application Data</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">2.12.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%9D%E8%80%83%E6%88%91%E4%BB%AC%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%B8%8B%E8%83%BD%E7%94%A8%E7%A7%81%E9%92%A5%E5%8E%BB%E7%A0%B4%E8%A7%A3tls%E5%8A%A0%E5%AF%86%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">3.</span> <span class="toc-text">思考：我们什么情况下能用私钥去破解 TLS 加密的数据</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2022/03/28/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%AF%86%E7%A0%81-%E5%85%AC%E9%92%A5%E5%AF%86%E7%A0%81RSA%E5%8E%9F%E7%90%86/" rel="bookmark" title="非对称密码-RSA原理">非对称密码-RSA原理</a></li><li><a href="/2022/03/28/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%AF%86%E7%A0%81-%E5%85%AC%E7%A7%81%E9%92%A5%E5%88%9B%E5%BB%BA/" rel="bookmark" title="非对称密码-公私钥的创建">非对称密码-公私钥的创建</a></li><li><a href="/2022/03/28/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%AF%86%E7%A0%81-SSL%E8%AF%81%E4%B9%A6/" rel="bookmark" title="非对称密码-SSL证书">非对称密码-SSL证书</a></li><li class="active"><a href="/2022/03/29/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%AF%86%E7%A0%81-HTTPS%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90/" rel="bookmark" title="HTTPS协议分析">HTTPS协议分析</a></li><li><a href="/2022/04/01/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%AF%86%E7%A0%81-%E4%BD%BF%E7%94%A8%E7%A7%81%E9%92%A5%E7%A0%B4%E8%A7%A3https%E6%B5%81%E9%87%8F/" rel="bookmark" title="非对称密码-使用私钥破解https流量">非对称密码-使用私钥破解https流量</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="ruyue" data-src="//fastly.jsdelivr.net/gh/ruyueattention/ruyueattention.github.io/images/avatar.jpg"><p class="name" itemprop="name">ruyue</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">38</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">11</span> <span class="name">分类</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3J1eXVlYXR0ZW50aW9u" title="https:&#x2F;&#x2F;github.com&#x2F;ruyueattention"><i class="ic i-github"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2022/03/28/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%AF%86%E7%A0%81-SSL%E8%AF%81%E4%B9%A6/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2022/04/01/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%AF%86%E7%A0%81-%E4%BD%BF%E7%94%A8%E7%A7%81%E9%92%A5%E7%A0%B4%E8%A7%A3https%E6%B5%81%E9%87%8F/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/%E5%85%B6%E4%BB%96-%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE/" title="分类于 其他 服务器配置">其他 服务器配置</a></div><span><a href="/2022/03/14/Tengine%E5%8A%A8%E6%80%81%E4%BF%AE%E6%94%B9upstream/" title="Tengine动态修改upstream">Tengine动态修改upstream</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Java/" title="分类于 Java">Java</a></div><span><a href="/2022/11/09/Java%20RMI%EF%BC%88%E8%BF%9C%E7%A8%8B%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8%EF%BC%89%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/" title="Java RMI（远程方法调用）漏洞利用">Java RMI（远程方法调用）漏洞利用</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%AF%86%E7%A0%81%E5%AD%A6/" title="分类于 密码学">密码学</a></div><span><a href="/2022/03/28/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%AF%86%E7%A0%81-SSL%E8%AF%81%E4%B9%A6/" title="非对称密码-SSL证书">非对称密码-SSL证书</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/" title="分类于 容器安全">容器安全</a></div><span><a href="/2022/02/25/k8s-kunbernetes%E7%94%A8%E6%88%B7%E5%92%8C%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/" title="k8s-Kubernetes用户和访问控制">k8s-Kubernetes用户和访问控制</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/" title="分类于 容器安全">容器安全</a></div><span><a href="/2022/05/12/docker%E8%AF%86%E5%88%AB/" title="Docker环境探测识别">Docker环境探测识别</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Java/" title="分类于 Java">Java</a></div><span><a href="/2022/11/29/Java%E5%86%85%E5%AD%98%E9%A9%AC1.5-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B3%A8%E5%85%A5%E5%86%85%E5%AD%98%E9%A9%AC/" title="Java内存马1.5:反序列化注入内存马">Java内存马1.5:反序列化注入内存马</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%AF%86%E7%A0%81%E5%AD%A6/" title="分类于 密码学">密码学</a></div><span><a href="/2022/03/29/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%AF%86%E7%A0%81-HTTPS%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90/" title="HTTPS协议分析">HTTPS协议分析</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="分类于 漏洞复现">漏洞复现</a></div><span><a href="/2021/10/09/Exchange%20Proxyshell/" title="Exchange Proxyshell">Exchange Proxyshell</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Java/" title="分类于 Java">Java</a></div><span><a href="/2022/11/15/Java%E5%86%85%E5%AD%98%E9%A9%AC1-Servlet-api%E5%86%85%E5%AD%98%E9%A9%AC/" title="Java内存马1:servlet-api类型内存马">Java内存马1:servlet-api类型内存马</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/" title="分类于 容器安全">容器安全</a></div><span><a href="/2022/02/15/k8s-kunbernetes%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" title="k8s-Kubernetes环境搭建">k8s-Kubernetes环境搭建</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2021 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">ruyue @ 如月专注</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">157k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">2:23</span></div><div class="powered-by"></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2022/03/29/非对称密码-HTTPS协议分析/",favicon:{show:"夺去目光的故事",hide:"蒙上双眼的故事"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//fastly.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="//fastly.jsdelivr.net/gh/ruyueattention/ruyueattention.github.io/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->